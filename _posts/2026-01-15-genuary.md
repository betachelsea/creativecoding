---
layout: work
title:  "Shadows"
date:   2026-01-15 00:00:00 +0900
desc: "Create an invisible object where only the shadows can be seen. #genuary 2026"
---

<script type="text/ruby">
CANVAS_HEIGHT = 750
CANVAS_WIDTH = 750
FRAMERATE = 60

BALL_NUMBER = 8
FLOOR_Y = 300
RADIUS = 60
OMEGA = (Math::PI * 2) / 3.0 # 1.5秒で1バウンス

class Color
  attr :r, :g, :b

  def set_random_color
    @r = rand(0..255)
    @g = rand(0..255)
    @b = rand(0..255)
  end

  def setup_with_alpha(alpha)
    # fill(r, g, b)
    fill("rgba(#{r},#{g},#{b},#{alpha})")
  end
end

class Ball

  def reset_values
    @h = rand(50..400)
    @d_x = rand(1..5)
    @d_y = rand(-100..100)
    @d_pi = rand(0.0..1.0)
    @color.set_random_color
  end

  def initialize
    @x = rand(-100..(CANVAS_WIDTH)+100)
    @h = rand(50..400)
    @color = Color.new
    reset_values
  end

  def draw_shadow(phase)
    strokeWeight(0);

    phase = phase + (Math::PI * @d_pi)
    phase %= (Math::PI * 2)
    u = Math.sin(phase).abs
    h = @h * (u ** 0.7) # h = H * (u ** 0.7)
    hn = h / @h # hn = h / H

    shadow_scale = lerp(0.2, 1.5, hn ** 0.8)

    blur = lerp(2, 8, (hn ** 1.0))
    drawingContext.filter = "blur(#{blur}px)"
    alpha = lerp(0.35, 0.1, (hn ** 1.2))
    @color.setup_with_alpha(alpha)
    ellipse(@x, FLOOR_Y + @d_y, (RADIUS * 1.6) * shadow_scale, (RADIUS * 1.0) * shadow_scale); # 影3

    drawingContext.filter = "none";
    fill("red")
    # ellipse(@x, FLOOR_Y + @d_y - h, RADIUS * 2, RADIUS * 2) # debug
    @x = @x + @d_x
    if CANVAS_WIDTH + 100 < @x
      @x = -100
      reset_values
    end
  end
end

def setup
  createCanvas(CANVAS_WIDTH, CANVAS_HEIGHT)
  frameRate(FRAMERATE)
  $phase = 0
  $balls = BALL_NUMBER.times.map { Ball.new }
end

def lerp(a, b, t) # 線形補間
  a + (b - a) * t
end


def draw
  clear
  dt = deltaTime / 1000.0 # milliseconds
  $phase += dt * OMEGA
  $phase %= (Math::PI * 2) # 2πを超えないようにする
  $balls.each do |ball|
   ball.draw_shadow($phase)
  end
end

P5::init()
</script>
